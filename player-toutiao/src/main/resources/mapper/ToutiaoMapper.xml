<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.player.toutiao.mapper.ToutiaoMapper">
    <sql id="recordSql">
        (
          id,
          channel_id,
          content,
          duration,
          href,
          img,
          img_num,
          `type` ,
          isTop,
          title,
          create_time,
          update_time,
          source,
          comment_id,
          labels,
          user_id,
          user_avatar,
          user_href,
          ranks,
          )VALUES(
          #{id},
          #{channelId},
          #{content},
          #{duration},
          #{href},
          #{img},
          #{imgNum},
          #{type} ,
          #{isTop},
          #{title},
          #{createTime},
          #{updateTime},
          #{source},
          #{commentId},
          #{labels},
          #{userId},
          #{userAvatar},
          #{userHref},
          #{ranks})
    </sql>

    <sql id="getArticleListSql">
        SELECT
            id,
            channel_id,
            duration,
            href,
            img,
            img_num,
            `type`,
            is_top,
            title,
            create_time,
            update_time,
            source,
            comment_id,
            labels,
            user_id,
            user_avatar,
            user_href,
            ranks
        FROM toutiao_article
    </sql>

    <select id="getArticleList" resultType="ArticleEntity">
        <if test="channelId == 0 and start == 0">
            (<include refid="getArticleListSql"></include> WHERE is_top = '1'AND channel_id = '0' ORDER BY create_time DESC LIMIT 0,3) UNION ALL
        </if>
        (<include refid="getArticleListSql"></include>
         where type != 'video' and is_top = '0'
        <if test="keyword!=null and keyword!=''">
            and title like concat('%',#{keyword},'%') or content like concat('%',#{keyword},'%')
        </if >
        <if test="type!=null and type!=''">
            and type = #{type}
        </if >
        <if test="channelId!=null and channelId!=''">
            and channel_id = #{channelId}
        </if >
        <if test="userId!=null and userId!=''">
            and user_id = #{userId}
        </if>
        ORDER BY create_time DESC  LIMIT #{start}, #{pageSize})
    </select>

    <select id="getArticleDetail" resultType="ArticleEntity">
        SELECT * FROM toutiao_article WHERE id = #{id}
    </select>

    <insert id="log" parameterType="com.player.common.entity.LogEntity">
       INSERT INTO log(method,url,headers,ip,params,query_string,result,start_time,run_time,description,end_time,type,oparation,user_id)VALUES(#{method},#{url},#{headers},#{ip},#{params},#{queryString},#{result},#{startTime},#{runTime},#{description},#{endTime},#{type},#{oparation},#{userId})
    </insert>

    <select id="getFavoriteChannels" resultType="ChannelEntity">
        SELECT * FROM toutiao_favorite_channel WHERE id = #{id} AND disabled = 0 ORDER BY sequence ASC
    </select>

    <select id="getAllChannels" resultType="ChannelEntity">
        SELECT * FROM toutiao_all_channel WHERE disabled = 0
        <if test="list != null and list.size() > 0">
            AND status IN
            <foreach item="item" index="index" collection="list" open="("  close=")" separator=",">
                #{item}
            </foreach>
        </if>
         ORDER BY sequence ASC
    </select>

    <insert id="insertFavoriteChannels">
        INSERT INTO toutiao_favorite_channel(channel_id,channel_name,href,create_time,update_time,user_id,disabled,status,sequence)
        VALUES
        <foreach collection ="list" item="item" separator =",">
            (#{item.channelId},#{item.channelName},#{item.href},#{item.createTime},#{item.updateTime},#{item.userId},#{item.disabled},#{item.status},#{item.sequence})
        </foreach >
    </insert>
</mapper>